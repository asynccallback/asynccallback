---
layout: post
title: "程序编译-重定位(实例)"
subtitle: 实例来讲解重定位
author: "404"
header-style: text
tags:
  - Linux
  - arm
  - 程序编译
  - 重定位
---

>本篇文章是原创，转载请注明

这篇文章我们从实例来说明程序如何来重定位，我们把自己当成计算机，一步一步来走其中过程。当然，我们首先需要一段代码，代码我们就选取《深入理解计算机系统》第七章中的代码。如下：
```c
/* main.c */

void swap();
int buf[5] = {31, 2, 14, 7, 88};
int test;

int main()
{
	int x = 16;
	int y;
	static static_x;
	static static_y = 1024;
	static int s = 15;
	swap();
	return 0;
}

int sss()
{
	static int s = 243;
}

```
```c

/* swap.c */

extern int buf[];
void swap();

int *bufp0 = &buf[0];
int *bufp1 ;
int test = 1;
int test2 = 324;

void swap()
{
	int temp;

	bufp1 = &buf[1];
	temp = *bufp0;
	*bufp0 = *bufp1;
	*bufp0 = temp;
	test = 10;

}

```
我在其中加了一些其他玩意以供分析使用。再自己写个`Makefile`或者不嫌麻烦手动一条一条去编译，我们生成了`main.o`和`swap.o`文件，接下来以这两个文件来分析。

我们经过前面的文章，知道elf的一些基本格式，如下：

![avatar](/img/in-post/Linux/201931201002.png)

头结构的详细结构如下，我们后面会结合实例来说。

![avatar](/img/in-post/Linux/201931301001.png)

符号表的具体格式如下：

![avatar](/img/in-post/Linux/201931301002.png)

首先我们不考虑生成两个文件的链接，我们单独那`main.o`来看，我们可以使用如下命令来看：

![avatar](/img/in-post/Linux/201931301003.png)

可以看到，这个文件对应着12个节（section），并且为其编号了。在地址那栏，由于我们还没有进行链接，故现在都为0。其中链接和信息，对应第一张图中的`link`和`inf`。举个例子，重定位`.rela.text`时，`link`为10，`inf`为1，我们找图中对应的标号，可以翻译为，`.symtab`中的内容会重定位，重定位到哪里呢？其实就是去`.text`里面去修改相应的值。








