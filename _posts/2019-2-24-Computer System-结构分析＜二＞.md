---
layout: post
title: "Computer System-结构分析＜二＞"
subtitle: '计算机结构基本分析，总线篇'
author: "404"
header-style: text
tags:
  - Computer System
  - BUS
---
#### 总线简介

计算机系统大多采用模块结构，一个模块就是实现具有某个（或某些）—特定功能的插件电路板，通常也叫做功能部件、插件、插卡。例如CPU模块、存储器模块、各种I/O接口卡等。各模块之间传送信息的公共通路称为总线。

从逻辑构成上看，总线由两部分构成：一是连接各个功能模块的信号线，二是起管理总线作用的总线控制器。

一般来说，一条系统总线要由大约几十条到上百条通信线路来构成。每条通信线路都被赋予一种特定的含义或功能。据其传输信号的含义，通信线路被分成数据、地址和控制等功能组，因而形成了数据总线、地址总线和控制总线。如下：
![avatar](/img/in-post/Linux/201922402001.png)

##### 数据总线

数据总线为系统部件之间提供传输数据的通路。数据总线的特点：
1. 双向传输。例如在CPU和内存之间的数据线，既可以传送CPU发送到内存的数据，也可以传送内存发送到CPU的数据。
2. 数据线的数目一般与计算机字长相同。
3. 采用具有三态能力的电路。

##### 地址总线

地址总线的作用是传送地址信号，它不仅用于传送内存地址，而且计算机系统对I/O端口的寻址也要通过地址总线来完成。例如，当计算机主机需要把数据传送到打印机上打印时，首先得把数据传送到打印机接口的数据缓冲寄存器中。要把数据正确地传送到打印机接口的数据缓冲寄存器中，主机需要预先把该数据缓冲寄存器的地址信息传送到地址总线上，打印机接口接收到这个地址并对地址信息进行译码分析，确认这个地址为打印机接口上的数据缓冲寄存器的地址，这样打印机接口的数据缓冲寄存器就能通过数据总线接收来自主机的数据，而其他外围设备的接口则对此地址不做响应。

在通常情况下，地址的高位部分用于形成芯片（或模块）的选片信号，而低位部分用于寻址芯片（或模块)内部的存储单元或I/O接口寄存器。例如针对某8位地址总线，现有一个容量为128个字大小的存储模块和一个具有128个接口寄存器的I/O接口模块，分别称为模块0和模块1，则8位地址的最高位用来实现模块的选择，其余7位用于模块内的存储单元或I/O接口寄存器的定位。例如，在地址总线上现有地址信息011111111，表示处理机要选择模块0的第128个存储单元；而地址信息10000000表示处理机要选择模块1的第1个I/O接口寄存器。

地址总线特点：
1. 单向传输。
2. 地址线的数目决定寻址能力的大小。

##### 控制总线

控制总线的作用是传送控制信号，以控制系统完成规定的操作功能。例如，利用控制信号在系统的各个功能模块之间指示命令和定时信号。其中，定时信号用于指示数据或地址信号的有效或无效，命令信号告诉功能模块执行什么操作。

控制总线可用于控制数据总线和地址总线的使用。因为数据/地址总线被系统所有的组件共享，因此必须要制定使用它们的方式和方法。例如，在CPU和磁盘控制器之间设有若干条控制信号线，其中有的是用于CPU发送控制命令给磁盘控制器的，如\"寻道\"、\"读\"、\"写\"等，也有的是用于磁盘控制器向CPU传送\"忙\"和\"完成\"的。

控制总线的特点：
1. 单向传输。
2. 控制线的类型和数目取决于总线类型。

典型的控制信号线包括以下：
- 存储器写信号：使数据总线上的数据写到指定的存储单元。
- 存储器读信号：将从指定的存储单元读出的数据放到数据总线上。
- I/O写信号：使数据总线上的数据输出到指定的I/O接口数据寄存器。
- I/O读信号：将从指定的I/O接口数据寄存器输入的数据放到数据总线上。
- 传输应答信号（ACK）：指示数据已被接收或已经放到数据总线上。
- 总线请求信号：指示一个功能模块需要获得总线的控制权。
- 总线授予信号：指示请求总线的功能模块已经获得了总线控制权。
- 中断请求信号：指示正在请求一个中断。
- 中断应答信号：指示先前请求的中断已经被响应。
- 时钟信号：用于使使用总线的各个功能模块上的操作实现时间上的同步。
- 复位信号：使总线上的各个功能模块初始化（复位）。

##### 总线控制器

总线控制器负责控制和分配总线的使用，具体包括以下几项功能：
1. 总线系统的资源分配与管理。负责向使用总线的功能模块分配中断向量号、DMA通道号以及I/O端口地址等资源。
2. 提供总线定时信号脉冲。
3. 负责总线使用权的仲裁。当多个模块都要使用总线发送信息时，总线控制器必须确定一个模块为当前总线的控制者，即总线的主控设备，简称主设备，这时其他使用总线的设备为从设备。当前的主控设备使用完成总线后，再确定下面总线的主控设备由哪一个模块来担当。
4. 负责实现不同总线协议的转换和不同总线之间传输数据的缓冲。

#### 总线的结构

在物理上，总线实际上由一系列并行的电子导体构成。以典型的系统总线为例，这些导体是蚀刻在一块印刷电路板上的金属线。总线向系统的所有组件提供服务，每个系统组件与总线上的全部或部分信号线相连接。典型的物理连接方案如下：
![avatar](/img/in-post/Linux/201922402002.png)
上图中，系统总线被安置到一块称为\"底板\"的印刷电路板上，由三组横向放置的导体构成。在该导体上等间距地设置四条内有总线信号接触点的插槽，这些插槽上可以以垂直方式插接印刷电路板（计算机的功能模块）。在一个计算机主机内部，每个主要的计算机系统组件可由一片或多片印刷电路板构成，并且插到系统总线的插槽中。
