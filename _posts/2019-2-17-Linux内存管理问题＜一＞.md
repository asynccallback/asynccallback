---
layout: post
title: "Linux内存管理问题＜一＞"
subtitle: '《奔跑吧Linux》书中的一些问题'
author: "404"
header-style: text
tags:
  - Linux
  - 内存
  - 《奔跑吧Linux》
---


**1.在启动时，ARM Linux内核如何知道系统中有多大的内存空间？**    
　　Answer：内存条上有[SPD芯片](https://en.wikipedia.org/wiki/Serial_presence_detect)，是通过IIC串行接口的EEPROM对内存插槽中的模组存在的信息检查的芯片。记录的配置信息包含：P-Bank、电压、行地址/列地址数量、位宽、各种主要操作时序（如CL、tRCD、tRP、tRAS等）……它们存放在一个容量为256字节的EEPROM中。SPD信息一般都是在出厂前，由内存模组制造商根据内存芯片的实际性能写入到ROM芯片中。上电时BIOS通过IIC读取SPD上内存相关的P-Bank数量、电压、行地址/列地址数量、位宽、各种操作时序等信息。  
　　BIOS会提供一个physical RAM map，内核启动时会解析从BIOS中读取到系统内存映射，并打印出来，实模式下的初始化代码通过使用BIOS的int 0x15服务并执行0xe820号函数（即上面的BIOS-e820字符串）来获得系统的内存映射信息。内存映射信息中包含了预留的和可用的内存，内核将随后使用这些信息创建其可用的内存池。
```
[    0.000000] BIOS-provided physical RAM map:
[    0.000000]  BIOS-e820: 0000000000000000 - 000000000009f800 (usable)
[    0.000000]  BIOS-e820: 000000000009f800 - 00000000000a0000 (reserved)
[    0.000000]  BIOS-e820: 00000000000f0000 - 0000000000100000 (reserved)
[    0.000000]  BIOS-e820: 0000000000100000 - 000000003f590000 (usable)
[    0.000000]  BIOS-e820: 000000003f590000 - 000000003f5e3000 (ACPI NVS)
[    0.000000]  BIOS-e820: 000000003f5e3000 - 000000003f5f0000 (ACPI data)
[    0.000000]  BIOS-e820: 000000003f5f0000 - 000000003f600000 (reserved)
[    0.000000]  BIOS-e820: 00000000e0000000 - 00000000f0000000 (reserved)
[    0.000000]  BIOS-e820: 00000000fec00000 - 0000000100000000 (reserved)
```
　　而在嵌入式系统中物理内存的实际大小是由bootloader传递给内核的，bootloader传递给内核的内存大小值是由开发人员根据内存的实际大小配置的，有改动就需要重新编译，而且并不是所有的物理内存内核都能用，有相当一部分内存会留给私有模块（像camera、gpu等），这些内存内核自身访问不到。  
　　综上：BIOS或boot loader把DDR的大小传递给Linux内核，因此从Linux内核角度来看DDR就是一段物理内存空间。  

**2.在32bit Linux内核中，用户空间和内核空间的比例通常是3：1，可以修改成2：2吗？**   
Answer：

**3.物理内存页面如何添加到伙伴系统中，是一页一页添加，还是以２的几次幂来加入呢？**  
Answer：

**4.内核的一级页表存放在什么地方？内核空间的二级页表又存放在什么地方**  
Answer：

**5.用户进程的一级页表存放在什么地方？耳机页表又存放在什么地方？**  
Answer：

**6.在ARM32系统中，页表是如何映射的？在ARM64系统中，页表又是如何映射的？**  
Answer：

**7.请简述Linux内核在理想情况下页面分配器（page allocator）是如何分配出连续物理页面的？**  
Answer：

**8.在页面分配器中，如何从分配掩码（fgp_mask）中确定可以从那些zone中分配内存？**  
Answer：

**9.页面非佩奇是按照什么方向来扫描zone的？**  
Answer：

**10.为用户进程分配物理内存，分配掩码应该选用GFP_KERNEL，还是GFP_HIGHUSER_NOVABLE呢？**  
Answer：
