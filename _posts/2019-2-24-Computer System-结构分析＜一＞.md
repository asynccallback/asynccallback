---
layout: post
title: "Computer System-结构分析＜一＞"
subtitle: '计算机结构基本分析，CPU篇'
author: "404"
header-style: text
tags:
  - Computer System
  - CPU
---
#### 计算机基本概述

传统结构"冯·诺依曼"结构体系的计算机结构如下：
![avatar](/img/in-post/Linux/2019224001.png)
上图中各个部件的作用：
- 运算器用来完成算术运算和逻辑运算，并将运算的中间结果暂存在运算器内。
- 存储器用来存放数据和程序。
- 控制器用来控制、智慧程序和数据的输入、运行以及处理运算结果。
- 输入设备用来将人们熟悉的信息形式转换为机器能识别的信息形式，常见的有键盘、鼠标等。
- 输出设备可将机器运算结果转换为人们熟悉的信息形式，如打印机输出、显示器输出等。

由于`运算器`和`控制器`在逻辑关系和电路结构上联系十分紧密，尤其在大规模集成电路制作工艺出现后，这两大部件往往集成在同一芯片上，因此，通常将它们合起来统称为中央处理器。把输入输出设备简称为I/O设备。

如此，现代计算机可认为由三大部分组成：CPU,I/O设备及主存储器（Main Memory，MM），组成部分如下图：
![avatar](/img/in-post/Linux/2019224002.png)
主存储器是存储器子系统中的一类，用来存放程序和数据，可以直接与CPU交换信息。另一类称为辅助存储器，简称辅存，又称外存。

算术逻辑单元（Arithmetic Logic Unit，ALU）简称算逻部件，用来完成算术逻辑运算。控制单元（Control Unit，CU）用来解释存储器中的指令，并发出各种操作命令来执行指令。ALU和CU是CPU的核心部件。

I/O设备也受CU控制，用来完成相应的输入、输出操作。

#### 简单例子 ax^2+bx+c

1. 将x取至运算器中。
2. 乘以x，得到x^2，存于运算器中。
3. 再乘以a，得ax^2,存于运算器中。
4. 将ax^2送至存储器中。
5. 取b至运算器中。
6. 乘以x，得bx，存于运算器中。
7. 将ax^2从存储器中取出与bx相加，得ax^2 + bx，存于运算器中。
8. 再取c与ax^2 + bx相加，得 ax^2 + bx + c,存于运算器中。

可见，不包括停机、输出打印共需8步。若将上式改写成：(ax + b)x + c,则其步骤可简化为以下5步。
1. 将x取至运算器中。
2. 乘以a，得到ax，存于运算器中。
3. 加b，得 ax + b，存于运算器中。
4. 乘以x，得(ax+b)x,存于运算器中。
5. 加c，得(ax+b)x + c, 存于运算器中。

将上述运算步骤写成某计算机一一对应的机器指令，就完成了运算程序的编写。

设某机的指令长尾16位，其中操作码占6位，地址码占10位。操作码解析如下：
![avatar](/img/in-post/Linux/2019224003.png)

计算过程如下：
![avatar](/img/in-post/Linux/2019224004.png)

#### 控制器

为了更形象的了解计算机的工作过程，用下图更细化的计算机组成框图来说明：
![avatar](/img/in-post/Linux/2019224005.png)

这里只细化说控制器，控制器是计算机的神经中枢，由它指挥各个部件自动、协调的工作。具体而言，它首先要命令存储器读出一条指令，称为取指过程。接着，它要对这条指令进行分析，指出该指令要完成什么样的操作，并按寻址特征指明操作数的地址，称为分析过程。最后根据操作数所在的地址以及指令的操作码完成某种操作，称为执行过程。大致就是取指、分析和执行3个阶段。

控制器由程序计数器（PC）、指令寄存器（IR)以及控制单元（CU)组成。
- PC用来存放当前欲执行指令的地址，它与主存的MAR之间有一条直接通路，且具有自动加1的功能，即可自动形成下一条指令地址。
- IR用来存放当前指令，IR的内容来自主存的MDR。IR中的操作码（OP(IR))送至CU，记作OP(IR)->CU，用来分析指令；其地址码（Ad（IR））作为操作数的地址送至存储器的MAR，记作Ad（IR)->MAR。
- CU用来分析当前指令所需完成的操作，并发出各种微操作命令序列，用以控制所有被控对象。

以上图计算过程来具体分析。首先上图中所有的有序指令和数据，通过输入到主存第0号至第12号单元中，并置PC的初始值为0（令程序的首地址为0）。启动机器后，计算机便自动按存储器中所存放的指令顺序有序地逐条完成取指令、分析指令和执行指令，直至执行到程序的最后一条指令为止。

启动机器后，控制器立即将PC的内容送至主存的MAR,并命令存储器做读操作，此刻主存\"0\"号单元的内容\"0000010000001000\"便被送入MDR内。然后由MDR送至控制器的IR，完成一条指令的取指过程。

结果CU分析，操作码\"000001\"为取指指令，于是CU又将IR中的地址码\"0000001000\"送至MAR，并命令存储器做读操作，将该地址单元中的操作数x送至MDR，再由MDR送至运算器的ACC，完成此指令的执行过程。此刻，也即完成了第一条取指令的全过程，与此同时PC完成自动加1的操作，形成下一条指令的地址\"1\"号。依此类推。
